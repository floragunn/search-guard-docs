---
title: Index Template Write History Audit Logging
html_title: Index Template Write History
permalink: compliance-index-template-write-history
category: auditlog-write-history
order: 300
layout: docs
edition: compliance
description: Use the Write History Audit Logging to monitor changes to sensitive data and stay compliant with GDRP, HIPAA, PCI and SOX.
resources:
  - "https://search-guard.com/gdpr-write-history/|
Write History: Monitoring document changes for GDPR compliance (blog post)"

---
<!---
Copyright 2022 floragunn GmbH
-->

# Index Template Write History Audit Logging
{: .no_toc}

{% include toc.md %}

Search Guard can monitor both insertion and deletion of index templates, as well as changes at the index template field level.

## Audit Log Category

Events generated by the index template write history audit trail are logged in the `COMPLIANCE_INDEX_TEMPLATE_WRITE` category.

## Field reference

Events in the `COMPLIANCE_INDEX_TEMPLATE_WRITE` category have the following attributes:

### Format, timestamp and category attributes

| Name | Description                                               |
|---|-----------------------------------------------------------|
| audit\_format\_version | Audit log message format version, current: 4|
| @timestamp | UTC timestamp when the event was generated|
| audit\_category | Audit log category, `COMPLIANCE_INDEX_TEMPLATE_WRITE` for all events |
{: .config-table}

### Cluster and node attributes

| Name | Description |
|---|---|
| audit\_cluster\_name | Name of the cluster this event was emitted on.|
| audit\_node\_id  | The ID of the node where the event was generated.|
| audit\_node\_name | The name of the node where the event was generated. |
| audit\_node\_host\_address |The host address of the node where the event was generated.|
| audit\_node\_host\_name |The host address of the node where the event was generated. |
{: .config-table}

### Request attributes

| Name | Description                                                              |
|---|--------------------------------------------------------------------------|
| audit\_request\_origin | The layer from which the event originated. One of `TRANSPORT` or `REST`.  |
| audit\_request\_remote\_address | The address where the request came from.  |
{: .config-table}

### User attributes

| Name                                          | Description |
|-----------------------------------------------|---|
| audit\_request\_effective\_user               | The username of the user that has accessed watched fields |
| audit\_request\_effective\_user\_auth\_domain | The domain that authenticated the user, as defined in `sg_authc.yml`. E.g. "ldap", "jwt" |
{: .config-table}

### Index template and fields attributes

| Name                                     | Description                                                                                                                  |
|------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|
| audit\_trace\_index\_templates           | Array, the index template(s) as contained in the request. Can contain wildcards.                                             |
| audit\_trace\_resolved\_index\_templates | Array, the resolved, concrete index template(s) affected by this request. |
| audit\_compliance\_operation                | The operation on the document, can be one of `CREATE`, `UPDATE` or `DELETE`.                                                       |
| audit\_compliance\_index\_template\_version | The version of the index template that has been inserted, changed or deleted. Only logged if template has a version set. Optional. |
| audit\_compliance\_diff\_content            | The diff of the old and new version of the template in JSON patch format. Only logged for `UPDATE`.                                |
| audit\_compliance\_diff\_is\_noop           | Boolean. False if any of the index template fields have been modified, otherwise true. Only logged for `UPDATE`.                   |
| audit\_request\_body                        | The content of newly created or updated template. Only logged if `searchguard.compliance.history.write.metadata_only` is `false`.  |
{: .config-table}

## Example

```json
{
  "audit_compliance_operation" : "UPDATE",
  "audit_cluster_name" : "local_cluster_1",
  "audit_trace_index_templates" : [ "test-template" ],
  "audit_node_name" : "data_0",
  "audit_category" : "COMPLIANCE_INDEX_TEMPLATE_WRITE",
  "audit_request_origin" : "REST",
  "audit_request_body" : "{\"index_patterns\":[\"new-pattern\"]}",
  "audit_node_id" : "jZTimIkOQK-fYDjqNz0caw",
  "@timestamp" : "2023-07-18T12:42:49.465+00:00",
  "audit_compliance_diff_is_noop" : false,
  "audit_trace_resolved_index_templates" : [ "test-template" ],
  "audit_format_version" : 4,
  "audit_request_remote_address" : "172.16.0.254",
  "audit_compliance_diff_content" : "[{\"op\":\"replace\",\"path\":\"/index_patterns\",\"value\":[\"new-pattern\"]}]",
  "audit_node_host_address" : "172.16.0.2",
  "audit_request_effective_user" : "user",
  "audit_request_effective_user_auth_domain" : "basic/internal_users_db",
  "audit_node_host_name" : "sgssl-1.example.com"
}
```

## Performance considerations

### Diffs

Logging the difference between two versions of a template has a performance impact.